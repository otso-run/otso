---
title: Architecture at a Glance
description: High‑level architecture and how pieces fit together.
sidebar:
  order: 4
---

```mermaid
graph LR
  S[Sources<br/>(APIs, archives)] --> C[Otso CLI]
  C --> DB[(SQLite / Postgres)]
  C --> E[Enrichment<br/>(Defuddle, AI, tags)]
  C --> D[Svelte Dashboard]
  DB --> PR[Projections<br/>(tables, JSON, search)]
  PR --> UI[Your Site & UI]
  C --> M[Micropub → Your Site]
  M --> W[Webmention]
  C --> P[POSSE → Mastodon / Bluesky / …]

  classDef store fill:#2b5,stroke:#185,stroke-width:1,color:#fff;
  class DB,PR store;
```

## Core concepts

- Events: append‑only records of actions (imported, enriched, published). Easy to audit and replay.
- Projections: derived tables/JSON/search indexes for fast reads. Rebuildable on demand.
- Adapters: thin plugins for sources (imports) and publishers (POSSE, Micropub).

## Storage: SQLite or Postgres

- Start with SQLite: fast, simple, great for local use and CLIs.
- Move to Postgres when you want concurrent writers, external services, or hosted ops.
- Replication and backup: use Litestream/LiteFS for SQLite; standard tools for Postgres.

## Import flow (any API or archive)

```mermaid
sequenceDiagram
  autonumber
  participant Src as Source API/Archive
  participant CLI as Otso CLI
  participant DB as Store (SQLite/Postgres)
  participant PR as Projections

  Src->>CLI: Fetch page (cursor / ETag / since‑ID)
  CLI->>CLI: Normalize → kinds + media
  CLI->>DB: Upsert with idempotency key
  DB-->>CLI: Insert/Update (or No‑op)
  CLI->>PR: Emit events → update projections
```

## Publish flow (your site is the source)

```mermaid
sequenceDiagram
  autonumber
  participant You as You
  participant CLI as Otso CLI
  participant Site as Your Site (Micropub)
  participant Net as Networks (POSSE)
  participant WM as Webmention

  You->>CLI: Compose post
  CLI->>Site: Micropub create
  Site-->>CLI: 201 Created + canonical URL
  CLI->>Net: Cross‑post with canonical link
  Site->>WM: Send/Receive webmentions
```

## Privacy & visibility

```mermaid
flowchart LR
  Item[Content item] -->|public| Pub[Public projections & feeds]
  Item -->|unlisted| Unl[Permalink only<br/>no index/feed]
  Item -->|private| Priv[Private tools only]
  Item -->|secret| Sec[Secure projection<br/>or encrypted vault]
  Idx[[Search Index]] -. excludes .-> Priv
  Idx -. excludes .-> Sec
```

- Credentials live in env vars or OS keychain; never in the repo or search indexes.

## What lives where

- Core SDK: stable data model, command surface, and utilities (rate limits, media).
- Plugins: per‑service logic (API/format quirks) and small mapping functions.
- Site/UI: thin layers over projections; easy to swap or customize.

This separation keeps Otso fast to use, easy to reason about, and safe to extend.
